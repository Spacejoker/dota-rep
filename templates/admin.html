{% extends "base.html" %}

{% block head %}

<script type="text/javascript">
var myModel = {
    self: this,
          status: ko.observable('Status'),
          total_matches: ko.observable('game count'),

    players: ko.observableArray([]), 

};
$(function(){
    ko.applyBindings(myModel);
});

var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};

$(function() {
    $('button#scrape_match').bind('click', function() {
        $.getJSON($SCRIPT_ROOT + '/_scrape_game', {
            match_id: $('input[name="match_id_input"]').val()//'67601693'
            }, function(data) {
            self.myModel.status('Added a game or two.');
        });
        return false;
    });
});


$(function() {
    $('button#remove_match').bind('click', function() {
        $.getJSON($SCRIPT_ROOT + '/admin/_remove_match', {
            }, function(data) {
            self.myModel.status('Deleted');
        });
        return false;
    });
});


$(function() {
    $('button#status').bind('click', function() {
        $.getJSON($SCRIPT_ROOT + '/admin/_status', {
            }, function(data) {
            self.myModel.total_matches(data.games_played);
            self.myModel.players(data.players);
        });
        return false;
    });
});


$(function() {
    $('button#scrape_player').bind('click', function() {
        $.getJSON($SCRIPT_ROOT + '/admin/_scrape_player', {
            match_id: $('select[name="player"]').val()
            }, function(data) {
            self.myModel.status('Player scraped');
        });
        return false;
    });
});


</script>

{% endblock %}

{% block body %}
<span data-bind="text: status">Status</span>
<span data-bind="text: total_matches">Status</span>
<br></br>
<input name="match_id_input"></input>
<button css="btn" id="scrape_match">Scrape match</button>
<button css="btn btn-warning" id="remove_match">Remove all matches</button>

<button css="btn" id="status">Get Status</button>
<br></br>
<p>
    Player to scrape 
    <select name="player" data-bind="options: players, optionsText: 'name', value: 'page_url', optionsCaption: 'Choose player'"></select>
</p>
<button css="btn" id="scrape_player">Scrape player</button>
{% endblock %}

