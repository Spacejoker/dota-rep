{% extends "base.html" %}

{% block head %}

<script type="text/javascript">
function Match(hero, match_id, k, d, a){
    var self = this;
    self.hero = hero;
    self.match_id = match_id;
    self.k = k;
    self.d = d;
    self.a = a;
}

var myModel = {
    self: this,
    status: ko.observable('Status'),
    row_data: ko.observableArray([]), 
    matches:  ko.observableArray([]),

    addRow : function(data) {
        this.matches.push(new Match(data.summary, data.match_id, data.k, data.d, data.a));
    },
};

$(function(){
    ko.applyBindings(myModel);
});

var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};

$(function() {
    $('button#load_games').bind('click', function() {
        $.getJSON($SCRIPT_ROOT + '/_load_games', {
            hero_name: $('select[name="hero"]').val()
            }, function(data) {
            var d = data.matches;
            self.myModel.matches([]);
            for(var i = 0; i < d.length; i++){
                self.myModel.addRow(d[i]);
            }
        });
        return false;
    });
});

$(function() {
    $('button#scrape_match').bind('click', function() {
        $.getJSON($SCRIPT_ROOT + '/_scrape_game', {
            match_id: $('input[name="match_id_input"]').val()//'67601693'
            }, function(data) {
            self.myModel.status('Added a game or two.');
        });
        return false;
    });
});


$(function() {
    $('button#remove_match').bind('click', function() {
        $.getJSON($SCRIPT_ROOT + '/admin/_remove_match', {
            }, function(data) {
            self.myModel.status('Deleted');
        });
        return false;
    });
});

</script>

{% endblock %}

{% block body %}
<a href="/admin">Admin</a>
<span data-bind="text: status">Status</span>
<input name="match_id_input"></input>
<button css="btn" id="scrape_match">Scrape match</button>
<button css="btn btn-warning" id="remove_match">Remove all matches</button>

<br/><br/>
<div class="container" style="background-color: #FCF3FF">
<div class="row">
    <div class="span4">
<select name="hero">
    <option value="Lina">Lina</option>
    <option value="Pugna">Pugna</option>
    <option value="Sven">Sven</option>
    <option value="Templar Assassin">Templar Assassin</option>
</select>
</div><div class="span4">

<button id="load_games" class="btn btn-primary">Load games</button>
</div>
<table class="table">
    <thead>
        <tr class='row'>
            <th class='span4'>Hero</th>
            <th class='span4'>Match ID</th> 
            <th class='span1'>Kills</th> 
            <th class='span1'>Deaths</th> 
            <th class='span1'>Assists</th> 
        </tr>
    </thead>
    <tbody data-bind="foreach: matches">
        <tr class='row'>
            <td class='span4' data-bind="text: hero"></td>
            <td class='span4' data-bind="text: match_id"></td>
            <td class='span1' data-bind="text: k"></td>
            <td class='span1' data-bind="text: d"></td>
            <td class='span1' data-bind="text: a"></td>
        </tr>
    </tbody>
</table>
</div>


{% endblock %}
